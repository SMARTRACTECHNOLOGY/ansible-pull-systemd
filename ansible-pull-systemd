#!/usr/bin/env bash

. /etc/ansible-pull-systemd.conf

TEMP=$(mktemp --tmpdir ansible-pull-tmp.XXXXXXXXXX)

runuser -l ${USER} -c "ansible-pull -U ${URL} -v -C ${CHECKOUT} -c local --private-key=${PRIVATE_KEY_FILE} --directory=${TEMP} --accept-host-key --purge ${EXTRA_ARGS}"

# There is a bug preventing purging the folder properly on become.
rm -rf ${TEMP}

systemctl disable ansible-pull-systemd.service
